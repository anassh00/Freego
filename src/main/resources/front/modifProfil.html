<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modification du profil - Freego</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  <!-- Style -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Google Icon -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <style>
    #imgContainer {
      height: fit-content;
      display: flex;
      justify-content: center;
    }
    #profilImage {
      width: 100px;
      border-radius: 100px;
    }
    #infoContainer input, #infoContainer textarea {
      background-color: transparent;
      border: none;
      color: white;
    }
    #infoContainer input:focus, #infoContainer textarea:focus {
      outline: none !important;
    }
    #arrowBack a i {
      font-size: 46px;
      color: white;
    }
    #geolocalise {
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: fit-content;
    }
    #geolocalise i {
      font-size: 20px;
    }
    #latitude, #longitude {
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="allContent pb-3">
    <div id="arrowBack" class="row m-1">
      <a href="javascript:void(0)" onclick="location.href='profil.html?userID=' + sessionStorage.getItem('userID');"><i class="material-icons">keyboard_backspace</i></a>
    </div>
    <div id="imgContainer" class="row p-3">
      <a href="javascript:void(0)" onclick="fUploadImage()" style="display: flex; justify-content: center; width: fit-content">
        <img id="profilImage" src="images/person_profile.png"/>
      </a>
      <input type="file" id="uploaderImage" hidden/>
    </div>
    <div id="infoContainer">
      <div class="row mx-3">
        <label for="pseudo" style="color: white;">Pseudo</label>
        <br>
        <input type="text" id="pseudo"/>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="prenom" style="color: white;">Prénom</label>
        <br>
        <input type="text" id="prenom"/>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="nom" style="color: white;">Nom</label>
        <br>
        <input type="text" id="nom"/>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="email" style="color: white;">Email</label>
        <br>
        <input type="email" id="email"/>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="phone" style="color: white;">Téléphone</label>
        <br>
        <input type="phone" id="phone"/>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="biographie" style="color: white;">Biographie</label>
        <br>
        <textarea type="text" id="biographie"></textarea>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <div class="row">
          <label style="color: white;">Adresse</label>
        </div>
        <div class="col" style="border-right: 1px solid white">
          <label for="latitude" style="color: white; font-size: 12px;">Latitude</label>
          <br>
          <input type="text" id="latitude"/>
        </div>
        <div class="col">
          <label for="longitude" style="color: white; font-size: 12px;">Longitude</label>
          <br>
          <input type="text" id="longitude"/>
        </div>
      </div>
      <div class="row mx-3" style="display: flex; justify-content: center; margin-top: 10px;">
        <button class="btn btn_submit mx-3" id="geolocalise" onclick="fGetLocation()"><i class="material-icons">my_location</i> Me géolocaliser</button>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3">
        <label for="motDePasse" style="color: white;">Mot de passe</label>
        <br>
        <input type="password" id="motDePasse"/>
        <span style="font-size: 10px; color: white;">Si vous laissez le champ vide, le mot de passe ne sera pas modifié !</span>
      </div>
      <hr class="mx-3" style="color: white; opacity: 1;">
      <div class="row mx-3" style="display: flex; justify-content: center;">
        <button class="btn_submit" onclick="fSendInformation()" style="width: 50%; height: 40px;">Sauvegarder</button>
      </div>
    </div>
  </div>

  <!-- Ecran de chargement -->
  <div id="ecranChargement"></div>

  <!-- Bootstrap Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <!-- Script -->
  <script src="js/script.js"></script>
  <script src="js/requetes.js"></script>
  <!-- jQuery -->
  <script src="js/jQuery.js"></script>
  <script>
    $(function(){
      $("#ecranChargement").load("ecranChargement.html");
      $("#ecranChargement").fadeIn();
    });

    onload = function() {
      if(sessionStorage.getItem('userID') == null) {
        location.href = "connexion.html";
      } else {
        $.ajax(getUserById(sessionStorage.getItem('userID'))).done(function (response) {
          console.log(response);
          document.querySelector("#pseudo").value = response.username;
          document.querySelector("#prenom").value = response.first_name;
          document.querySelector("#nom").value = response.last_name;
          document.querySelector("#email").value = response.email;
          document.querySelector("#phone").value = response.phone;
          document.querySelector("#biographie").value = response.biographie;
          document.querySelector("#latitude").value = response.latitude;
          document.querySelector("#longitude").value = response.longitude;
          // Fin du chargement des données
          document.body.style.backgroundColor = "#E94E1B";
          fFinChargement();
        });
      }
    }

    function fSendInformation() {
      const pseudo = document.querySelector("#pseudo").value;
      const prenom = document.querySelector("#prenom").value;
      const nom = document.querySelector("#nom").value;
      const email = document.querySelector("#email").value;
      const phone = document.querySelector("#phone").value;
      const biographie = document.querySelector("#biographie").value;
      const latitude = document.querySelector("#latitude").value;
      const longitude = document.querySelector("#longitude").value;
      const motDePasse = document.querySelector("#motDePasse").value;
      $.ajax(updateUserInfo(sessionStorage.getItem('userID'), pseudo, prenom, nom, email, phone, biographie, latitude, longitude, (motDePasse != "" ? motDePasse : null) )).done(function (response) {
        console.log(response);
      });
    }

    function fGetLocation() {
      navigator.geolocation.getCurrentPosition(
              function(pos) {
                document.querySelector("#latitude").value = pos.coords.latitude;
                document.querySelector("#longitude").value = pos.coords.longitude;
              },
              function(err) {
                alert("Erreur : " + err.message);
              });
    }

    function fUploadImage() {
      document.querySelector("#uploaderImage").click();
    }
  </script>
</body>
</html>