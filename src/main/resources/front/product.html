<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    
    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Google Icon -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <title>Produit - Freego</title>

    <style>
      #imageContainer {
        height: 300px;
        background-image: url('images/carottes.png');
        background-size: cover;
      }
      #imageContainer a {
        width: fit-content;
        padding: 0;
      }
      #photo1, #photo2, #photo3 {
        height: 24px;
        background-color: rgba(0,0,0,0.1);
      }
      .backArrow {
        font-size: 46px;
        background-color: rgba(0,0,0,0.1);
      }
      #imageContainer a i {
        color: white;
      }
      #profilContainer {
        height: fit-content;
        background-color: #E94E1B;
      }
      #produitContainer p {
        font-size: 12px;
        color: #345DA8;
      }
      #btnReserv button {
        width: 100%;
      }
      .userImage {
        width: 55px;
        border-radius: 50px;
      }
      #prenomNom {
        color: white;
        font-weight: bold;
        font-size: 14px;
      }
      #btnReserv {
        display: none;
      }
      #btnModSupp {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="imageContainer">
      <div class="row mx-1" style="height: 5%";>
        <a href="home.html"><i class="material-icons backArrow">keyboard_backspace</i></a>
      </div>
      <div class="row" style="height: 85%;"></div>
      <div class="row" style="display: flex; justify-content: center">
        <a href="javascript:void(0)" id="photo1" onclick="fChangePhoto(this);"><i class="material-icons">radio_button_checked</i></a>
        <a href="javascript:void(0)" id="photo2" onclick="fChangePhoto(this);"><i class="material-icons">radio_button_unchecked</i></a>
        <a href="javascript:void(0)" id="photo3" onclick="fChangePhoto(this);"><i class="material-icons">radio_button_unchecked</i></a>
      </div>
    </div>
    <div id="profilContainer" class="p-3">
      <div class="row">
        <div class="col-auto">
          <img class="userImage" src="images/person_profile.png"/>
        </div>
        <div class="col" style="display: flex; align-items: center;">
          <div id="prenomNom" class="row"></div>
          <!--
          <div class="row">
            Notation
          </div>
          -->
        </div>
        <div id="sendMessageContainer" class="col-auto" style="display: none; align-items: center">
          <button class="btn_submit" onclick="fSendMessage()" style="width: fit-content">Envoyer un message</button>
        </div>
      </div>
    </div>
    <div id="produitContainer" class="m-3">
      <h3></h3>
      <h6 id="etatProduit"></h6>
      <div id="btnReserv" class="my-3">
        <button id="btnRes" class="btn btnModifProfil" style="justify-content: center">RÃ©server</button>
      </div>
      <div id="btnModSupp" class="row">
        <div class="col">
          <button id="btnMod" class="btn btnModifProfil" style="justify-content: center">Modifier</button>
        </div>
        <div class="col">
          <button id="btnSupp" class="btn btnModifProfil" style="justify-content: center">Supprimer</button>
        </div>
      </div>
      <h6>Description du produit</h6>
      <p></p>
    </div>

    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <!-- Script -->
    <script src="js/script.js"></script>
    <script src="js/requetes.js"></script>
    <!-- jQuery -->
    <script src="js/jQuery.js"></script>

    <script>
      let userId = -1;

      function fChangePhoto(item) {
        const images = ['images/carottes.png', 'images/conserves.jpg', 'images/aliments.jpg'];
        const imageContainer = document.querySelector("#imageContainer");
        switch(item.id) {
          case "photo1":
            imageContainer.style.backgroundImage = "url(" + images[0] + ")";
            break;
          case "photo2":
            imageContainer.style.backgroundImage = "url(" + images[1] + ")";
            break;
          case "photo3":
            imageContainer.style.backgroundImage = "url(" + images[2] + ")";
            break;
        }
        const allA = item.parentElement.querySelectorAll("a");
        allA.forEach(a => {
          if(a.id != item.id) {
            a.querySelector("i").innerHTML = "radio_button_unchecked";
          } else {
            a.querySelector("i").innerHTML = "radio_button_checked";
          }
        })
      }

      function fSendMessage() {
        location.href = 'message.html?userID=' + userId;
      }

      onload = function() {
        if(sessionStorage.getItem('userID') == null) {
          location.href = "connexion.html";
        } else {
          const url = new URL(location.href);
          const search_params = new URLSearchParams(url.search);
          if(search_params.has('productID')) {
            const productID = search_params.get('productID');
            $.ajax(getProductById(productID)).done(function (product) {
              userId = product.user.id;
              document.querySelector("#prenomNom").innerHTML = product.user.first_name + " " + product.user.last_name;
              const produitContainer = document.querySelector("#produitContainer");
              produitContainer.querySelector("h3").innerHTML = product.name;
              produitContainer.querySelector("#etatProduit").innerHTML = product.etat;
              produitContainer.querySelector("p").innerHTML = product.description;
              if(product.user.id != sessionStorage.getItem('userID')) {
                document.querySelector("#sendMessageContainer").style.display = 'flex';
                document.querySelector("#btnReserv").style.display = 'flex';
                document.querySelector("#btnRes").onclick = function() {
                  $.ajax(reserveProduct(productID)).done(function () {
                    location.href = "message.html?userID=" + product.user.id;
                  });
                }
              } else {
                document.querySelector("#btnModSupp").style.display = 'flex';
                document.querySelector("#btnMod").onclick = function() {
                  location.href = "modifProduit.html?productID=" + productID;
                }
              }
            });
          }
        }
      }
    </script>
  </body>
</html>